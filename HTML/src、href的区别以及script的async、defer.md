
## src 和 href

### 区别

- **src：** 表示对资源的引用，它指向的内容会嵌入到当前标签所在的位置。src会将其指向的资源下载并应⽤到⽂档内，如请求js脚本。当浏览器解析到该元素时，会暂停其他资源的下载和处理，直到将该资源加载、编译、执⾏完毕，所以⼀般js脚本会放在页面底部。
- **href：** 表示超文本引用，它指向一些网络资源，建立和当前元素或本文档的链接关系。当浏览器识别到它他指向的⽂件时，就会并⾏下载资源，不会停⽌对当前⽂档的处理。 常用在a、link等标签上。

### **加载行为**

- **`src`**：`src`属性加载的资源通常是页面的一部分（例如图片或脚本），它们会在加载时嵌入页面。浏览器在解析到带有`src`的标签时，会暂停渲染或解析其他部分，直到资源加载完毕。
    - 例如，当浏览器遇到`<script src="file.js">`时，它会暂停文档解析，直到脚本加载完成并执行。
- **`href`**：`href`属性指定了一个导航目标或关联资源，它不会直接嵌入到页面中。
    - 例如，`<a href="https://example.com">` 会提供一个链接，用户点击时会导航到指定网址；`<link href="styles.css">` 会引用外部的CSS样式表，但不会阻塞页面的加载。

### **应用场景**

- **`src`**：用于需要加载并嵌入的资源，如：
    - 图片：`<img src="image.jpg">`
    - 媒体文件：`<audio src="audio.mp3">`
    - 脚本：`<script src="script.js">`
    - 框架内容：`<iframe src="page.html">`

- **`href`**：用于创建链接或引用外部资源，如：
    - 超链接：`<a href="https://example.com">`
    - 样式表：`<link href="styles.css">`

### 总结

- **`src`** 用于加载和嵌入资源，如图片、脚本、音视频、iframe等，内容会被直接加载到页面中。
- **`href`** 用于创建超链接或引用外部资源（如CSS文件），通常是导航和外部关联，而不会嵌入到页面中。

## script 标签的 async 和 defer

![image.png](https://img.glcn.top//piclist/1733397312676-3bfd7f18f3b84d149c92bd774d78037c.png)

### 默认行为的 script 标签

`<script src="script.js"></script>`

如果没有defer或async属性，浏览器会立即加载并执行相应的脚本。它不会等待后续加载的文档元素，读取到就会开始加载和执行，这样就阻塞了后续文档的加载。

- 加载和执行script.js时，HTML解析都暂停

总结就是读取到就立即阻塞性加载执行

### async 属性的 script 标签

`<script async src="script.js"></script>`

- **加载行为**：`async` 会异步加载脚本。脚本下载和HTML解析是并行进行的。
- **执行时机**：一旦脚本下载完成，**立即执行**，即使此时HTML文档尚未完全解析完毕。因此，脚本可能会在文档解析的中间执行。
- **影响顺序**：多个`async`脚本的执行顺序不一定按照它们在文档中出现的顺序来执行，**执行顺序取决于它们加载完成的时间**。哪个脚本先加载完成，哪个就先执行。

总结就是并行加载，立即执行

### defer 属性的 script 标签

`<script defer src="script.js"></script>`

- **加载行为**：`defer` 同样异步加载脚本，脚本下载和HTML解析是并行进行的。
- **执行时机**：脚本会等到HTML文档**完全解析完毕后**才执行（即文档的 `DOMContentLoaded` 事件触发之前）。这保证了脚本是在页面结构完全构建好之后执行的。
- **影响顺序**：多个带`defer`的脚本会**按照它们在文档中出现的顺序**依次执行，即使它们的加载顺序不同。

总结就是并行加载，HTML解析完成后按顺序执行，然后触发DOMContentLoaded事件

### 表格对比

| **特性**                  | **默认行为**                   | **`defer`**                | **`async`**                 |
| ----------------------- | -------------------------- | -------------------------- | --------------------------- |
| **加载行为**                | 脚本会阻塞HTML解析，直到脚本加载完成       | 脚本与HTML解析**同时**进行，异步加载     | 脚本与HTML解析**同时**进行，异步加载      |
| **执行时机**                | 脚本加载完毕后**立即执行**，然后继续解析HTML | HTML文档**解析完毕**后执行（按顺序执行）   | 脚本加载完毕后**立即执行**（不等待HTML解析完） |
| **执行顺序**                | 按照脚本在HTML中的出现顺序执行          | 按照脚本在HTML中的出现顺序执行          | **不保证执行顺序**，哪个脚本先加载完就先执行    |
| **适用场景**                | 需要按顺序执行的脚本，脚本依赖前面内容或脚本     | 需要在DOM完全加载后执行的脚本，通常是依赖DOM的 | 独立的、不依赖DOM或其他脚本的脚本（如分析工具）   |
| **是否阻塞HTML解析**          | **是**，脚本加载和执行会阻塞HTML解析     | **否**，脚本加载不会阻塞，执行也在HTML解析后 | **是**，脚本加载不会阻塞，但执行会暂停HTML解析 |
| **DOMContentLoaded 事件** | 可能会延迟触发，因为脚本会阻塞解析          | 在所有`defer`脚本执行完之后才触发       | 可能会在`async`脚本之前或之后触发        |
### 可能的坑

defer不一定按顺序执行，如果是这样的话

```html
<script defer src="1.js"></script>
<script defer src="2.js"></script>
```

其中1.js会插入几个DOM，2.js会操作1.js生成的DOM，这个时候就容易出问题

建议改为`<script src="1.js"></script>`，丢进HTML解析同步加载
